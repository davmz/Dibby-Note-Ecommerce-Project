MODEL:

class User < ApplicationRecord
  before_save { self.email = email.downcase }

  VALID_EMAIL_REGEX = /\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i

  # Validation
  validates :first, :last, :fullname, presence: true, length: { maximum: 50 }
  validates :email, presence: true, length: { maximum: 255 },
                    format: { with: VALID_EMAIL_REGEX },
                    uniqueness: { case_sensitive: false }

  has_secure_password
  validates :password, presence: true, length: { minimum: 6 }
end

CONTROLLER:

class UsersController < ApplicationController
  http_basic_authenticate_with name: "admin", password: "password", only: [:index]

  def index
    @users = User.all
  end

  def show
    @user = User.find(params[:id])
  end

  def new
    @user = User.new
  end

  def create
    @user = User.new(user_params)

    if @user.save
      flash[:success] = "Welcome to DibbyNote, #{@user.fullname}}"
      redirect_to @user
      # redirect_to root_path, notice: "Successfully created account"
    else
      render :new
    end
  end

  private

    def user_params
      params.require(:user).permit(:first, :last, :fullname, :email, :password,
                                   :password_confirmation)
    end
end

APPLICATION.HTML.ERB:

<body>
  <div class="container">
    <% flash.each do |message_type, message| %>
      <div class="alert alert-<%= message_type %>"><%= message %></div>
    <% end %>
    <%= yield %>
  </div>
</body>

ROUTES:

get "signup", to: "users#new"
post "signup", to: "users#create"
resources :users, only: [:index, :show]

VIEWS:

<h1>Sign up</h1>

<%= form_with model: @user, url: signup_path, local: true, data: { turbo: false }  do |form| %>  <% if @user.errors.any? %>
    <div id="error_explanation">
      <div class="alert alert-danger">
        The form contains <%= pluralize(@user.errors.count, "error") %>.
      </div>
      <ul>
      <% @user.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.label :first %>
  <p>
    <%= form.text_field :first, placeholder: "Dibby" %>
  </p>

  <%= form.label :last %>
  <p>
    <%= form.text_field :last, placeholder: "Note" %>
  </p>

  <%= form.label :fullname %>
  <p>
    <%= form.text_field :fullname, placeholder: "Dibby Note" %>
  </p>

  <%= form.label :email %>
  <p>
    <%= form.text_field :email, placeholder: "dibbynote@gmail.com" %>
  </p>

  <%= form.label :password %>
  <p>
    <%= form.password_field :password, placeholder: "password" %>
  </p>

  <%= form.label :password_confirmation, "Confirmation" %>
  <p>
    <%= form.password_field :password_confirmation, placeholder: "password" %>
  </p>

  <div>
    <%= form.submit "Sign Up" %>
  </div>
<% end %>

SHOW:

<h1>Account Settings: </h1>

<p>
  Full Name: <%= @user.fullname %>
</p>

<p>
  Email: <%= @user.email %>
</p>

<p>
  Password: <%= @user.password_digest %>
</p>

ADD_INDEX_TO_USERS_EMAIL MIGRATION:

class AddIndexToUsersEmail < ActiveRecord::Migration[7.0]
  def change
    add_index :users, :email, unique: true
  end
end

ADD_PASSWORD_DIGEST_TO_USERS:

class AddPasswordDigestToUsers < ActiveRecord::Migration[7.0]
  def change
    add_column :users, :password_digest, :string
  end
end